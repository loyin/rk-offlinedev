<!doctype html>
<html>
<head>
    <title>离线开发- 首页</title>
    <style>
      .about{
      background-color: #fbfb97;
      width: 800px;
      font-size: 11px;
      color: #f36f2d;
      font-weight: bold;
      margin-left: 20px;
      margin-top: 20px;
      margin-bottom: 20px;
      }
      .download-btn{
        background-color: #61bd61;
        color:white;
      }
      .download-btn.busy{
        background-color: red;
        color:white;
      }
    </style>
</head>
<body>
    <img src="/img/fet.jpg" style="width:42px;"/>
    <div>
  <b>欢迎！！离线开发首页</b>
  <div class="about">
    说明： 
    <br>点击下面绿色的"Sync"按钮下载模拟数据
    <br>-去\\10.10.0.115\publicwebapp\offlinedev目录，用户名密码是developer/developer
    <br>-然后，点击下面的主页面入口：

  </div>
  选择模拟数据：<span><select id="caseselect"></select><button id="download-btn" class="download-btn">Sync</button></span>
  <span><a target="_blank" href="./index.action">首页</a></span>、
  <span style="display: none;"><a target="_blank" href="./index.action?isdeploy=true">首页（打包）</a></span>
  <span><a target="_blank" href="./designer.action?entityId=1&layoutId=58473">PC设计器</a></span>、
  <span><a target="_blank" href="./appdesigner.action?entityId=1&layoutId=58473">APP设计器</a></span>
  </div>
<hr>
    <div>
  <span>单元测试</span>
  <span><a href="./test.action">Unit Tests</a></span>
</div>
<div>
  <span>端测试</span>
  <span><a href="./test.action?case=testCase_datetimepicker">datetimepicker</a></span>
  </div>
  <script src="./offlinedev/js/jquery.min.js"></script>
  <script type="text/javascript">
    var ls_key = 'offlinedev_casename'

    $('#caseselect').on('change', function(){
      var casename = $(this).val();
      localStorage.setItem(ls_key, casename);
    })
    $.ajax({
            url: 'http://10.10.0.115:3004/offlinedev/folders',
            jsonp: "callback",
            jsonpCallback:"Callback",
            dataType: "jsonp",
            cache: false,
            data: {},
            success: function( response ) {
                console.log(response)
                var data = JSON.parse(response);
                console.log(data)
                var html = '<option value="">LOCAL</option>'
                data.forEach(function(name){
                  name = name.replace(/\/{1,}/g,'');
                  html += '<option value="'+name+'">remote115: ' +name+ '</option>'
                })
                $('#caseselect').html(html)
                $('#caseselect').val(localStorage.getItem(ls_key))
            },
            error:function(ajaxObj,msg,err){
            }
        });
    var save = function(){
      $.ajax({
            url: '/offlinedev/saveUserConfig/',
            cache: false,
            method: 'POST',
            data: {
              caseName: 2222
            },
            success: function( response ) {

            },
            error:function(ajaxObj,msg,err){
            }
        });
    }
    $('#download-btn').click(function(){
      var caseName = $('#caseselect').val()
      if(!caseName){
         alert('本地开发，不需同步')
         return;
      }
      $('#download-btn').addClass('busy')
      $('#download-btn').text('downloading...')
       $.ajax({
            url: '/offlinedev/syncCases/',
            cache: false,
            method: 'POST',
            data: {
              caseName: $('#caseselect').val()
            },
            success: function( response ) {
              $('#download-btn').removeClass('busy')
              $('#download-btn').text('Success, reSync')
            },
            error:function(ajaxObj,msg,err){
            }
        });
    })
  </script>
</body>
</html>